<header class="relative bg-white xs:pt-4" id="header">
  <nav class="flex w-full">
    {% render 'feature-nav' %}
  </nav>
  <a href="/" class="mt-2 xs:mt-4 block text-center text-lg xs:text-xl font-bold text-gray-500">
    {{ shop.name }}
  </a>
  <nav class="mt-8 px-6 w-5/6 hidden xs:flex justify-center mx-auto border-t border-b border-gray-300" id="site-nav">
    {% render 'site-nav' %}
  </nav>
  <div class="w-full h-full fixed top-0 left-0 z-0" v-show="isAccountVisible || isMobileVisible" @click="closeAllModals" style="z-index: -10;"></div>
</header>

<script>
store.onReady(() => {
    console.log('vue app loading');
    const header = document.getElementById('header');
    const Header = Vue.createApp({
        created() {
        },
        computed: {
            isAccountVisible() {
              return store.vue.state.account.visible;
            },
            isMobileVisible() {
              return store.vue.state.mobile.visible;
            },
        },  
        methods: {
            toggleAccountModal() {
              store.vue.toggleAccountModal();
            },
            toggleMobileModal() {
              console.log('toggling');
              store.vue.toggleMobileModal();
            },
            toggleNestedLinks(event) {
                this.$refs[event.target.id].classList.toggle('hidden');
                this.$refs[event.target.id].classList.toggle('nested-link-animation-in');
                this.$refs[event.target.id + "-caret-down"].classList.toggle('hidden');
                this.$refs[event.target.id + "-caret-up"].classList.toggle('hidden');
                this.closeAllNested(event.target.id);
            },
            closeAllNested(currentNest = null) {
              const nested = Object.keys(this.$refs);
              nested.forEach(nest => {
                if (!nest.includes('caret') && nest !== currentNest) {
                  this.$refs[nest].classList.add('hidden');
                  this.$refs[nest].classList.remove('nested-link-animation-in');
                  this.$refs[nest + "-caret-down"].classList.add('hidden');
                  this.$refs[nest + "-caret-up"].classList.remove('hidden');
                }
              })
            },
            closeAllModals() {
              store.vue.closeAll();
              this.closeAllNested();
            }
        }
    }).mount(header);
});
</script>

<style scoped>
    .cart-button:hover .cart-count {
    transform: translateY(-16px);
    opacity: 1;
  }

  .account-modal-enter-active {
    animation: animate-modal-right .2s forwards;
  }

  .account-modal-leave-active {
    animation: animate-modal-right .2s reverse;
  }

  .mobile-modal-enter-active {
    animation: animate-modal-left .2s forwards;
  }

  .mobile-modal-leave-active {
    animation: animate-modal-left .2s reverse;
  }

  .nested-link-animation-in {
    animation: animate-modal-left .2s forwards;
  }

  @keyframes animate-modal-right {
    from {
      right: 0;
      opacity: 0;
    }
    to {
      right: 2rem;
      opacity: 1;
    }
  }

  @keyframes animate-modal-left {
    from {
      left: 0;
      opacity: 0;
    }
    to {
      left: 2rem;
      opacity: 1;
    }
  }
</style>

{% schema %}
{
    "name": "Header",
    "settings": [
        {
            "type": "text",
            "id": "mobile_menu_heading",
            "default": "Menu",
            "label": "Mobile Menu Heading"
        },
        {
            "type": "link_list",
            "id": "menu",
            "default": "main-menu",
            "label": "Main Navigation Menu"
        }
    ]
}
{% endschema %}
